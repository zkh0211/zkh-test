'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _findDeepestNode = require('./find-deepest-node');

var _findDeepestNode2 = _interopRequireDefault(_findDeepestNode);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Get caret position from selection point.
 *
 * @param {String} key
 * @param {Number} offset
 * @param {State} state
 * @param {Editor} editor
 * @param {Element} el
 * @return {Object}
 */

function getCaretPosition(key, offset, state, editor, el) {
  var document = state.document;

  var text = document.getDescendant(key);
  var schema = editor.getSchema();
  var decorators = document.getDescendantDecorators(key, schema);
  var ranges = text.getRanges(decorators);

  var a = 0;
  var index = void 0;
  var off = void 0;

  ranges.forEach(function (range, i) {
    var length = range.text.length;

    a += length;
    if (a < offset) return;
    index = i;
    off = offset - (a - length);
    return false;
  });

  var span = el.querySelector('[data-offset-key="' + key + '-' + index + '"]');
  var node = (0, _findDeepestNode2.default)(span);
  return { node: node, offset: off };
}

/**
 * Export.
 *
 * @type {Function}
 */

exports.default = getCaretPosition;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9nZXQtY2FyZXQtcG9zaXRpb24uanMiXSwibmFtZXMiOlsiZ2V0Q2FyZXRQb3NpdGlvbiIsImtleSIsIm9mZnNldCIsInN0YXRlIiwiZWRpdG9yIiwiZWwiLCJkb2N1bWVudCIsInRleHQiLCJnZXREZXNjZW5kYW50Iiwic2NoZW1hIiwiZ2V0U2NoZW1hIiwiZGVjb3JhdG9ycyIsImdldERlc2NlbmRhbnREZWNvcmF0b3JzIiwicmFuZ2VzIiwiZ2V0UmFuZ2VzIiwiYSIsImluZGV4Iiwib2ZmIiwiZm9yRWFjaCIsInJhbmdlIiwiaSIsImxlbmd0aCIsInNwYW4iLCJxdWVyeVNlbGVjdG9yIiwibm9kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0E7Ozs7OztBQUVBOzs7Ozs7Ozs7OztBQVdBLFNBQVNBLGdCQUFULENBQTBCQyxHQUExQixFQUErQkMsTUFBL0IsRUFBdUNDLEtBQXZDLEVBQThDQyxNQUE5QyxFQUFzREMsRUFBdEQsRUFBMEQ7QUFBQSxNQUNoREMsUUFEZ0QsR0FDbkNILEtBRG1DLENBQ2hERyxRQURnRDs7QUFFeEQsTUFBTUMsT0FBT0QsU0FBU0UsYUFBVCxDQUF1QlAsR0FBdkIsQ0FBYjtBQUNBLE1BQU1RLFNBQVNMLE9BQU9NLFNBQVAsRUFBZjtBQUNBLE1BQU1DLGFBQWFMLFNBQVNNLHVCQUFULENBQWlDWCxHQUFqQyxFQUFzQ1EsTUFBdEMsQ0FBbkI7QUFDQSxNQUFNSSxTQUFTTixLQUFLTyxTQUFMLENBQWVILFVBQWYsQ0FBZjs7QUFFQSxNQUFJSSxJQUFJLENBQVI7QUFDQSxNQUFJQyxjQUFKO0FBQ0EsTUFBSUMsWUFBSjs7QUFFQUosU0FBT0ssT0FBUCxDQUFlLFVBQUNDLEtBQUQsRUFBUUMsQ0FBUixFQUFjO0FBQUEsUUFDbkJDLE1BRG1CLEdBQ1JGLE1BQU1aLElBREUsQ0FDbkJjLE1BRG1COztBQUUzQk4sU0FBS00sTUFBTDtBQUNBLFFBQUlOLElBQUliLE1BQVIsRUFBZ0I7QUFDaEJjLFlBQVFJLENBQVI7QUFDQUgsVUFBTWYsVUFBVWEsSUFBSU0sTUFBZCxDQUFOO0FBQ0EsV0FBTyxLQUFQO0FBQ0QsR0FQRDs7QUFTQSxNQUFNQyxPQUFPakIsR0FBR2tCLGFBQUgsd0JBQXNDdEIsR0FBdEMsU0FBNkNlLEtBQTdDLFFBQWI7QUFDQSxNQUFNUSxPQUFPLCtCQUFnQkYsSUFBaEIsQ0FBYjtBQUNBLFNBQU8sRUFBRUUsVUFBRixFQUFRdEIsUUFBUWUsR0FBaEIsRUFBUDtBQUNEOztBQUVEOzs7Ozs7a0JBTWVqQixnQiIsImZpbGUiOiJnZXQtY2FyZXQtcG9zaXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBmaW5kRGVlcGVzdE5vZGUgZnJvbSAnLi9maW5kLWRlZXBlc3Qtbm9kZSdcblxuLyoqXG4gKiBHZXQgY2FyZXQgcG9zaXRpb24gZnJvbSBzZWxlY3Rpb24gcG9pbnQuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGtleVxuICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldFxuICogQHBhcmFtIHtTdGF0ZX0gc3RhdGVcbiAqIEBwYXJhbSB7RWRpdG9yfSBlZGl0b3JcbiAqIEBwYXJhbSB7RWxlbWVudH0gZWxcbiAqIEByZXR1cm4ge09iamVjdH1cbiAqL1xuXG5mdW5jdGlvbiBnZXRDYXJldFBvc2l0aW9uKGtleSwgb2Zmc2V0LCBzdGF0ZSwgZWRpdG9yLCBlbCkge1xuICBjb25zdCB7IGRvY3VtZW50IH0gPSBzdGF0ZVxuICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuZ2V0RGVzY2VuZGFudChrZXkpXG4gIGNvbnN0IHNjaGVtYSA9IGVkaXRvci5nZXRTY2hlbWEoKVxuICBjb25zdCBkZWNvcmF0b3JzID0gZG9jdW1lbnQuZ2V0RGVzY2VuZGFudERlY29yYXRvcnMoa2V5LCBzY2hlbWEpXG4gIGNvbnN0IHJhbmdlcyA9IHRleHQuZ2V0UmFuZ2VzKGRlY29yYXRvcnMpXG5cbiAgbGV0IGEgPSAwXG4gIGxldCBpbmRleFxuICBsZXQgb2ZmXG5cbiAgcmFuZ2VzLmZvckVhY2goKHJhbmdlLCBpKSA9PiB7XG4gICAgY29uc3QgeyBsZW5ndGggfSA9IHJhbmdlLnRleHRcbiAgICBhICs9IGxlbmd0aFxuICAgIGlmIChhIDwgb2Zmc2V0KSByZXR1cm5cbiAgICBpbmRleCA9IGlcbiAgICBvZmYgPSBvZmZzZXQgLSAoYSAtIGxlbmd0aClcbiAgICByZXR1cm4gZmFsc2VcbiAgfSlcblxuICBjb25zdCBzcGFuID0gZWwucXVlcnlTZWxlY3RvcihgW2RhdGEtb2Zmc2V0LWtleT1cIiR7a2V5fS0ke2luZGV4fVwiXWApXG4gIGNvbnN0IG5vZGUgPSBmaW5kRGVlcGVzdE5vZGUoc3BhbilcbiAgcmV0dXJuIHsgbm9kZSwgb2Zmc2V0OiBvZmYgfVxufVxuXG4vKipcbiAqIEV4cG9ydC5cbiAqXG4gKiBAdHlwZSB7RnVuY3Rpb259XG4gKi9cblxuZXhwb3J0IGRlZmF1bHQgZ2V0Q2FyZXRQb3NpdGlvblxuIl19